<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Camera Bob</title>
  <script src="bower_components/tracking/build/tracking-min.js"></script>
  <script src="bower_components/tracking/build/data/face-min.js"></script>
  <script src="bower_components/tracking/assets/stats.min.js"></script>
  
   <script src="js/dat.gui.min.js"></script>

  <style>
	 

  video, canvas {
    margin-left: 230px;
    margin-top: 120px;
    position: absolute;
  }
  
  video {
	  opacity:0; 
  }
  
  </style>
</head>
<body>
  <div class="container">
    <div class="video-stuff">
      <video id="video" width="320" height="240" preload autoplay loop muted></video>
      <canvas id="canvas" width="320" height="240"></canvas>
    </div>
    <div class="audio-stuff">
		<audio id="audio-player" controls autoplay loop>
		  <source src="assets/DavidCutterMusicVol2-03.mp3" type="audio/mpeg">
		</audio>
	</div>
  </div>

  <script>
    window.onload = function() {
		
      var video = document.getElementById('video');
      var canvas = document.getElementById('canvas');
      var ctx = canvas.getContext('2d');
      var tracker = new tracking.ObjectTracker('face');
      tracker.setInitialScale(4);
      tracker.setStepSize(2);
      tracker.setEdgesDensity(0.1);
      tracking.track('#video', tracker, { camera: true });
	  
	  
	  var lastLoop = new Date;
	  var prevFrame = {};
	  var count = 0;
	  
  	var music= document.getElementById("audio-player");
	  
  	var soundCounter = 0;
	var increase = Math.PI * 2 / 100;
	  
      tracker.on('track', function(event) {
		 
        ctx.clearRect(0, 0, canvas.width, canvas.height);
		
		setupLine();
		
        event.data.forEach(function(face) {
				
			ctx.fillStyle = "#F00";
			ctx.fillRect(face.x+(face.width/2)-2, face.y+(face.height/2)-2, 4, 4);

			ctx.strokeStyle = '#a64ceb';
			ctx.strokeRect(face.x, face.y, face.width, face.height);
			ctx.font = '11px Helvetica';
			ctx.fillStyle = "#fff";
			ctx.fillText('x: ' + face.x + 'px', face.x + face.width + 5, face.y + 11);
			ctx.fillText('y: ' + face.y + 'px', face.x + face.width + 5, face.y + 22);

			var thisLoop = new Date;
			 var fps = 1000 / (thisLoop - lastLoop);
			 lastLoop = thisLoop;
 
			/* ***************
			Check Frame Differences
			*************** */
			var xDif =  face.x - prevFrame.x;
			var yDif =  face.y - prevFrame.y;			 
			prevFrame = Object.assign({}, face);
 
	  	  y = Math.sin( soundCounter ) / 2 + 0.5;
	  	  soundCounter += increase;
		  
		  music.volume = y;
		  
		 // console.log(y*100);
		  
			 count++;
			 if(count > 30) {
				 count = 0;
			 }
        });
		
		/* ***************
		Setup centerlines
		*************** */
		function setupLine() {
			ctx.strokeStyle = '#a64ceb';
			ctx.beginPath();
			
			ctx.moveTo(0, canvas.height/2);
			ctx.lineTo(canvas.width, canvas.height/2);
			ctx.stroke();
			
			ctx.moveTo(canvas.width/2, 0);
			ctx.lineTo(canvas.width/2, canvas.height);
			
			ctx.stroke();
		};
		
		/*
		audioControls
		*/

      });

	
	  
      var gui = new dat.GUI();
      gui.add(tracker, 'edgesDensity', 0.1, 0.5).step(0.01);
      gui.add(tracker, 'initialScale', 1.0, 10.0).step(0.1);
      gui.add(tracker, 'stepSize', 1, 5).step(0.1);
    };
  </script>

</body>
</html>